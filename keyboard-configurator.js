let isScrolling=!1;class ProductConfigurator{constructor(){this.data=JSON.parse(document.getElementById("configurator-data").textContent),this.parentProductTitle=this.data.parentProductTitle,this.components=this.data.components,this.conflicts=this.data.conflicts||[],this.selectedComponent=null,this.configuration={},this.optionsContent=document.querySelector(".configurator__options"),this.selectedVariants=new Map,this.initialImages=new Map,this.temporarySelections=new Map,this.showPlaceholders=!0,this.totalRequiredComponents=0,this.completedRequiredComponents=0,this.toastTimeouts=new Map,this.selectedVariant=null,this.quantities=new Map,this.isMobileLayout=this.checkIsMobile(),this.carouselIndex=0,this.carouselCards=[],this.carouselIsDragging=!1,this.carouselStartX=0,this.carouselCurrentX=0,this.counterTotal=document.querySelector(".counter-total"),this.counterCurrent=document.querySelector(".counter-current"),document.addEventListener("input",t=>{t.target.classList.contains("variant-quantity")&&this.handleQuantityChange(t)}),this.conflictBadges=new Map,this.init()}init(){this.totalRequiredComponents=this.components.filter(e=>e.required).length,this.counterTotal.textContent=this.totalRequiredComponents,this.counterCurrent.textContent="0",this.initializeComponentTabs(),this.setUpMobileLayout(),this.setupComponentCards(),this.initializeConfiguratorSummary(),this.setupResponsiveListener(),this.setupKeyboardNavigation(),this.setupRemoveButton(),this.initializeEventListeners(),fetch("/cart.js").then(e=>e.json()).then(e=>{const t=document.querySelector(".view-cart-link");t&&0<e.item_count&&(t.style.display="block")}).catch(e=>console.error("Error fetching cart:",e)),this.showPlaceholders||document.querySelectorAll(".component-layer").forEach(e=>{e.classList.add("hidden")}),0<this.components.length&&this.selectComponent(this.components[0].handle);const e=document.querySelector(".prev-component"),t=document.querySelector(".next-component"),n=document.querySelector(".forward-component");e&&e.addEventListener("click",()=>{this.navigateComponents("prev")}),t&&t.addEventListener("click",()=>{this.navigateComponents("next")}),n&&n.addEventListener("click",()=>{this.navigateComponents("next")});const o=document.querySelector(".add-to-cart-button");o&&o.addEventListener("click",t=>{t.preventDefault();const e=[];let n=!1;o.classList.add("loading"),o.textContent="Adding to Cart...",o.disabled=!0;const a=document.querySelector(".view-cart-link"),i=new Map;return this.selectedVariants.forEach((e,t)=>{const o=t.replace(/-optional$/,""),a=this.components.find(e=>e.handle===o);if(e){const t=Array.isArray(e)?e:[e];t.forEach(e=>{if(!e.available)return this.showToast(`${e.title} is sold out`,"error"),void(n=!0);const t=i.get(e.id)||{id:e.id,quantity:0,properties:{_component:e.title}};t.quantity+=e.quantity||1,i.set(e.id,t)})}}),e.push(...i.values()),n||0===e.length?(o.classList.remove("loading"),o.textContent="Add to Cart",void(o.disabled=!1)):void fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({items:e})}).then(e=>e.ok?e.json():e.json().then(e=>{throw new Error(JSON.stringify(e))})).then(()=>{o.classList.remove("loading"),o.textContent="Added to Cart!",o.disabled=!0,a&&(a.style.display="block");const t=document.querySelector("#CartCount span:first-child");if(t){const n=parseInt(t.textContent,10)||0,o=n+e.length;t.textContent=o}this.showToast("Items added to cart!","success"),document.dispatchEvent(new CustomEvent("cart:refresh"))}).catch(e=>{console.error("Cart error:",e),o.classList.remove("loading"),o.textContent="Add to Cart",o.disabled=!1;try{const t=JSON.parse(e.message);this.showToast(t.description||"Error adding items to cart","error")}catch(t){this.showToast("Error adding items to cart","error")}})})}initializeEventListeners(){const e=document.querySelector(".remove-selection-button");e&&e.addEventListener("click",()=>{const t=this.components.find(e=>e.handle===this.selectedComponent.handle);if(t){this.removeComponentFromConfiguration(t);const n=document.querySelector(".options-grid");if(n){const e=n.querySelectorAll("select");e.forEach(e=>{e.value=""})}applyButton&&(applyButton.classList.remove("hidden"),applyButton.disabled=!1,applyButton.textContent="Add to Configuration"),e.classList.add("hidden")}}),document.addEventListener("click",t=>{if(t.target.closest(".remove-optional")){const e=t.target.closest(".remove-optional"),n=e.dataset.handle,o=parseInt(e.dataset.variantId),a=`${n}-optional`,i=this.selectedVariants.get(a);if(!i)return;const l=Array.isArray(i)?i:[i],r=l.filter(e=>e.id!==o);0===r.length?this.selectedVariants.delete(a):this.selectedVariants.set(a,r),this.updateConfiguratorSummary(),this.updateTotalPrice(),this.evaluateConflicts()}}),document.addEventListener("click",t=>{const e=t.target.closest(".conflict-suggestion-button");if(!e)return;const n=e.parentNode.closest("[data-component]"),o=n?.dataset.component.includes("optional")||!1,a=e.dataset.component,i=parseInt(e.dataset.variantId,10),l=o?`${a}-optional`:a;this.selectComponent(l);const r=l.replace(/-optional$/,""),d=this.components.find(e=>e.handle===r);if(d){const e=d.variants.find(e=>e.id===i);e&&(this.selectedVariant=e,this.applySelection())}})}initializeConfiguratorSummary(){const e=document.createElement("div");e.className="configuration-summary";const t=document.createElement("button");t.className="summary-header",t.setAttribute("aria-expanded","true"),t.innerHTML=`
      <h2>Configuration Breakdown</h2>
      <svg class="chevron-icon" viewBox="0 0 24 24" width="24" height="24">
        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
      </svg>
    `;const n=document.createElement("div");n.className="summary-content";const o=document.createElement("div");o.className="summary-section required-components",o.innerHTML=`
      <h3 class="summary-section__title">Essential Components</h3>
      <div class="summary-items">
        ${this.components.filter(e=>e.required).map(e=>`
            <div class="summary-item required-item" data-component="${e.handle}">
              <div class="summary-item__content">
                <h4 class="summary-item__title">${this.formatComponentTitle(e.title)}</h4>
                <div class="summary-item__variant-row">
                  <div class="summary-item__variant-wrapper">
                    <div data-variant-id="${this.selectedVariants.get(e.handle)?.id||""}" class="summary-item__variant ${this.selectedVariants.get(e.handle)?"selected":"pending"}">
                      ${this.selectedVariants.get(e.handle)?this.selectedVariants.get(e.handle).title:"Pending Selection"}
                      ${this.selectedVariants.get(e.handle)&&!this.selectedVariants.get(e.handle).available?`
                        <div class="variant-tooltip">
                          <div class="variant-tooltip-text">
                            This variant is sold out.
                          </div>
                        </div>
                      `:""}
                    </div>
                  </div>
                  <div class="summary-item__price">${this.selectedVariants.get(e.handle)?"$"+(this.selectedVariants.get(e.handle).price/100).toFixed(2):"\u2014"}</div>
                </div>
              </div>
            </div>
          `).join("")}
      </div>
    `;const a=document.createElement("div");a.className="summary-section optional-components",a.innerHTML=`
      <h3 class="summary-section__title">Optional Components</h3>
      <div class="summary-items">
        <div class="summary-item optional-item">
          <div class="summary-item__content">
            <div class="summary-item__variant-row">
              <div class="summary-item__variant">None Selected</div>
            </div>
          </div>
        </div>
      </div>
    `,n.appendChild(o),n.appendChild(a);const i=document.createElement("div");i.className="summary-footer";const l=document.createElement("div");l.className="summary-total",l.innerHTML=`
      <div class="summary-total__title">Total</div>
      <div class="summary-total__price">$0.00</div>
    `;const r=document.createElement("div");r.className="cart-actions";const d=document.createElement("button");d.type="button",d.className="btn add-to-cart-button product-form__cart-submit disabled",d.disabled=!0,d.textContent=`${this.getCompletedRequiredCount()} / ${this.totalRequiredComponents} Components Selected`;const s=document.createElement("a");s.href="/cart",s.className="view-cart-link",s.textContent="View Cart \u2192",r.appendChild(d),r.appendChild(s),i.appendChild(l),i.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(i),this.insertConfiguratorSummary(e),t.addEventListener("click",()=>{const e="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",!e),n.style.display=e?"none":"block"})}insertConfiguratorSummary(e){const t=1024>=window.innerWidth,n=document.querySelector(".configurator__options"),o=document.querySelector(".mobile-bottom-bar");e&&n&&o&&(t?!o.contains(e)&&o.insertBefore(e,o.firstChild):!n.contains(e)&&n.appendChild(e))}initializeComponentTabs(){const e=document.querySelectorAll(".tab-button"),t=document.getElementById("required-components"),n=document.getElementById("optional-components"),o=document.querySelectorAll(".component-card");e.forEach(o=>{o.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),o.classList.add("active"),"required"===o.dataset.tab?(t.style.display="flex",n.style.display="none"):(t.style.display="none",n.style.display="flex",this.updateExtraComponents());const a="required"===o.dataset.tab?t:n,i=a.querySelector(".component-card:not([style*=\"display: none\"])");i&&this.selectComponent(i.dataset.componentId,!0)})}),n.style.display="none",this.updateExtraComponents()}setupComponentCards(){document.querySelectorAll(".component-card").forEach(e=>{const t=e.dataset.componentId,n=e.querySelector(".component-card__mobile .component-card__image"),o=e.querySelector(".component-card__desktop .component-card__image");this.initialImages.set(t,{mobile:n?.src,desktop:o?.src});const a=e.querySelectorAll(".visibility-toggle");a.forEach(n=>{n.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();const e=document.getElementById(`layer-${t}`),a=n.querySelector(".eye-visible"),i=n.querySelector(".eye-hidden");if(e&&a&&i){const t=!e.classList.contains("hidden");t?(e.classList.add("hidden"),a.classList.add("hidden"),i.classList.remove("hidden")):(e.classList.remove("hidden"),a.classList.remove("hidden"),i.classList.add("hidden"))}});const o=document.getElementById(`layer-${t}`),a=n.querySelector(".eye-visible"),i=n.querySelector(".eye-hidden");if(o&&a&&i){const e=!o.classList.contains("hidden");a.classList.toggle("hidden",!e),i.classList.toggle("hidden",e)}}),e.addEventListener("click",()=>{e.classList.contains("locked")||this.handleComponentClick(e.dataset.componentId)})})}handleComponentClick(e){this.selectComponent(e)}selectComponent(e,t=!1){if(!t&&this.selectedComponent&&this.selectedComponent.handle===e.replace(/-optional$/,""))return;const n=e,o=e.replace(/-optional$/,"");if(this.selectedComponent){const e=this.selectedComponent.isOptionalSelection?`${this.selectedComponent.handle}-optional`:this.selectedComponent.handle,t=document.querySelector(`.component-card[data-component-id="${e}"]`);t&&t.classList.remove("selected")}if(this.selectedComponent=this.components.find(e=>e.handle===o),!!this.selectedComponent){this.selectedComponent.isOptionalSelection=n.endsWith("-optional");const e=document.querySelector(`.component-card[data-component-id="${n}"]`);e&&(e.classList.add("selected"),e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}));const t=document.querySelector(".selected-component-title");t&&(t.textContent=this.formatComponentTitle(this.selectedComponent.title,this.selectedComponent.isOptionalSelection,this.selectedComponent.required));const o=document.querySelector(".component-navigation__image");if(o){const t=e?.querySelector(".component-card__image")?.src;t&&(o.src=t)}this.updateNavigationButtons(),this.checkIsMobile()?(this.updateOptionsGrid("carousel"),this.updateSelectedVariant("carousel")):(this.updateOptionsGrid("desktop"),this.updateSelectedVariant("desktop"))}}setupRemoveButton(){const e=document.querySelector(".remove-selection-button");e&&e.addEventListener("click",()=>{const e=this.components.find(e=>e.handle===this.selectedComponent);if(e){this.removeComponentFromConfiguration(e);const t=document.querySelector(".options-grid");if(t){const e=t.querySelectorAll("select");e.forEach(e=>{e.value=""})}const n=document.querySelector(".apply-selection-button");n&&(n.classList.remove("hidden"),n.textContent="Apply to Configuration")}})}getAvailableOptionsForPosition(e,t,n="desktop"){if(!this.selectedComponent||!this.selectedComponent.variants)return[];this.selectedComponent.options.length;console.log("getting options for",e,t,this.selectedComponent.variants);let o=this.selectedComponent.variants;if(1<e){const n=new Map;for(let o=1;o<e;o++){const e=t.get(o);if(!e)return[];n.set(o,e.replace(/ - SOLD OUT$/,"").replace(/ - \$[\d.,]+( - \$[\d.,]+)?/,""))}o=o.filter(e=>{const t=e.title.split(" / ");return Array.from(n.entries()).every(([e,n])=>t[e-1]===n)})}const a=new Map;o.forEach(t=>{const n=t.title.split(" / "),i=n[e-1];if(!i)return;if(a.has(i))return;const l=o.filter(t=>{const n=t.title.split(" / ");return n[e-1]===i}),r=l.map(e=>e.price),d=Math.min(...r),s=Math.max(...r),c=l.every(e=>!e.available);let u=i;u+=d===s?` - $${(d/100).toFixed(2)}`:` - $${(d/100).toFixed(2)} - $${(s/100).toFixed(2)}`,c&&(u+=" - SOLD OUT"),a.set(i,u)});const i=Array.from(a.values());return(console.log("available options for",e,i),0===i.length)?[]:(1===i.length&&setTimeout(()=>{console.log("auto-selecting",i[0]);const t="desktop"===n?`.option-select[data-position="${e}"]`:`.mobile-option-select[data-position="${e}"]`,o=document.querySelector(t);if(console.log(t,o),o){const e=i[0].split(" - ")[0];console.log(`raw value: ${e} vs: ${o.value}`),o.value!==e&&(console.log("auto-selecting",e),o.value=e,o.dispatchEvent(new Event("change")))}},0),i)}updateOptionsGrid(e="desktop"){const t="desktop"===e?document.querySelector(".options-grid"):document.querySelector(".mobile-carousel-track .mobile-component-card.active .mobile-card-options");t&&(t.classList.remove("active"),setTimeout(()=>{this.updateOptionsContent(t,e),requestAnimationFrame(()=>{t.classList.add("active")}),t.querySelectorAll("select").forEach(e=>{2===e.options.length&&(e.selectedIndex=1,e.dispatchEvent(new Event("change")))})},200))}updateOptionsContent(e,t="desktop"){e.innerHTML="";const n=new Map;if(this.selectedComponent&&this.selectedComponent.options){const o=document.querySelector(".options-container");if(o){const a=o.querySelector(".options-title");if(a&&(a.textContent=this.formatComponentTitle(this.selectedComponent.title,this.selectedComponent.isOptionalSelection,this.selectedComponent.required)),this.selectedComponent.options.forEach((o,a)=>{const i=a+1,l=document.createElement("div");l.className="option-container";const r=document.createElement("label");r.textContent=o.name;const d=document.createElement("select");d.className="desktop"===t?"option-select":"mobile-option-select",d.dataset.optionName=this.handleize(o.name),d.dataset.position=i;const s=document.createElement("option");s.value="",s.textContent=`Select ${o.name}`,s.disabled=!0,s.selected=!0,d.appendChild(s);const c=this.getAvailableOptionsForPosition(i,n,t);c.forEach(e=>{const t=document.createElement("option");t.value=e.split(" - ")[0],t.textContent=e,d.appendChild(t)});const u=this.selectedVariants.get(this.selectedComponent.handle);if(u&&!this.selectedComponent.isOptionalSelection){const e=this.parseVariantTitle(u.title),t=e[i-1];t&&(d.value=t,n.set(i,t))}d.addEventListener("change",e=>this.handleVariantChange(e,t)),l.appendChild(r),l.appendChild(d),e.appendChild(l)}),"desktop"!==t&&this.checkIsMobile()&&this.handleDropDownAvailability(e),this.selectedComponent.isOptionalSelection){const t=document.createElement("button");t.textContent="Add to Configuration",t.className="apply-selection-button";const n=Array.from(e.querySelectorAll("select")).map(e=>e.value);t.disabled=!this.isValidVariant(n),t.addEventListener("click",()=>{if(this.checkIsMobile()){const n=e.closest(".mobile-component-card");this.applySelection(t,n)}else this.applySelection(t,e);t.textContent="Added to Configuration"}),e.appendChild(t)}}}}getMatchingVariantFromSelections(e){return this.selectedComponent?this.selectedComponent.variants.find(t=>{const n=t.title.split(" / ").map(e=>e.trim().toLowerCase().replace(/ - sold out$/i,""));return!(n.length!==e.length)&&e.every((e,t)=>e.trim().toLowerCase()===n[t])})||null:null}isValidVariant(e){return console.log(!!this.getMatchingVariantFromSelections(e)),console.log(this.getMatchingVariantFromSelections(e)),!!this.getMatchingVariantFromSelections(e)}resetOptionsContent(e){const t=e.querySelectorAll("select");t.forEach(e=>{e.selectedIndex=0});const n=e.querySelector(".apply-selection-button");n&&(n.textContent="Add to Configuration",n.disabled=!0)}handleDropDownAvailability(e){const t=e.previousElementSibling;t&&t.classList.contains("locked")?e.querySelectorAll("select, input, button.apply-selection-button").forEach(e=>{e.disabled=!0}):e.querySelectorAll("select, input, button.apply-selection-button").forEach(e=>{e.disabled=!1})}updateConfiguratorSummary(){const e=document.querySelector(".required-components .summary-items"),t=document.querySelector(".optional-components .summary-items");if(!e||!t)return;let n="";const o=this.components.filter(e=>e.required);o.forEach(e=>{const t=this.selectedVariants.get(e.handle),o=t&&!t.available;n+=`
        <div class="summary-item required-item" data-component="${e.handle}">
          <div class="summary-item__content">
            <h4 class="summary-item__title">${this.formatComponentTitle(e.title)}</h4>
            <div class="summary-item__variant-row">
              <div class="summary-item__variant-wrapper">
                <div data-variant-id="${t&&t.id}" class="summary-item__variant ${o?"sold-out":t?"selected":"pending"}">
                  ${t?t.title:"Pending Selection"}
                  ${o?`
                    <div class="variant-tooltip">
                      <div class="variant-tooltip-text">
                        This variant is sold out.
                      </div>
                    </div>
                  `:""}
                </div>
              </div>
              <div class="summary-item__price">${t?"$"+(t.price/100).toFixed(2):"\u2014"}</div>
            </div>
          </div>
        </div>
      `}),e.innerHTML=n;let a="",i=!1;this.selectedVariants.forEach((e,t)=>{if(!t.endsWith("-optional"))return;i=!0;const n=t.replace("-optional",""),o=this.components.find(e=>e.handle===n);if(o){const i=Array.isArray(e)?e:[e];i.forEach(e=>{const i=e.quantity||1,l=e.price*i,r=!e.available;a+=`
  
          <div class="summary-item optional-item" data-component="${t}" data-variant-id="${e.id}">
            <div class="summary-item__content">
              <h4 class="summary-item__title">${this.formatComponentTitle(o.title)}</h4>
              <div class="summary-item__variant-row">
                <div class="summary-item__variant-group">
                  <div class="summary-item__variant-wrapper">
                    <div data-variant-id="${e&&e.id}" class="summary-item__variant ${r?"sold-out":""}">
                      ${e.title}
                      ${r?`
                        <div class="variant-tooltip">
                          <div class="variant-tooltip-text">
                            This variant is sold out. You will not be able to complete your configuration while this variant is selected.
                          </div>
                        </div>
                      `:""}
                    </div>
                  </div>
                  <button class="remove-optional" data-handle="${n}" data-variant-id="${e.id}">
                    <svg viewBox="0 0 24 24" width="16" height="16">
                      <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                  </button>
                </div>
                <div class="summary-item__price-group">
                  <div class="quantity-input">
                    <span class="quantity-prefix">x</span>
                    <input 
                      type="number" 
                      class="variant-quantity" 
                      value="${i}"
                      min="1"
                      data-handle="${n}"
                      data-variant-id="${e.id}"
                      ${r?"disabled":""}
                    >
                  </div>
                  <div class="summary-item__price">$${(l/100).toFixed(2)}</div>
                </div>
              </div>
            </div>
          </div>
        `})}}),i||(a=`
        <div class="summary-item optional-item">
          <div class="summary-item__content">
            <div class="summary-item__variant-row">
              <div class="summary-item__variant">None Selected</div>
            </div>
          </div>
        </div>
      `),t.innerHTML=a,this.updateTotalPrice()}updateTotalPrice(){const e=document.querySelector(".configuration-summary");if(!e)return;let t=0;this.selectedVariants.forEach(e=>{const n=Array.isArray(e)?e:[e];n.forEach(e=>{const n=e.quantity||1;t+=e.price*n})});const n=e.querySelector(".summary-total__price");n&&(n.textContent=`$${(t/100).toFixed(2)}`);const o=0<t;e.classList.contains("has-items")!==o&&e.classList.toggle("has-items",o)}updateUI(e){if(!e||!this.selectedComponent)return;const t=document.querySelector(".button-container");if(!t)return;const n=t.querySelector(".add-to-configuration"),o=document.getElementById("option-quantity");if(n){e.available?(n.disabled=!1,n.classList.remove("hidden"),o&&(o.value=1)):(n.disabled=!0,n.classList.add("hidden"));const t=this.selectedComponent.required?"Select":"Add to Configuration";n.textContent=t}const a=e.featured_image?.src||e.featured_image||this.selectedComponent.featured_image;if(!a)return;const i=this.selectedComponent.isOptionalSelection?`${this.selectedComponent.handle}-optional`:this.selectedComponent.handle,l=this.selectedComponent.isOptionalSelection;var r=null;if(r=l?document.querySelector(`.component-card[data-component-id="${this.selectedComponent.handle}-optional"]`):document.querySelector(`.component-card[data-component-id="${this.selectedComponent.handle}"]`),r){const t=r.querySelector(".component-card__desktop .component-card__image");if(t){t.src=a;const e=document.querySelector(".component-navigation__image");e&&(e.src=a,e.classList.remove("loading"))}const n=r.querySelectorAll(".option-flag");n.forEach((t,n)=>{const o=t.dataset.option;if(!o)return;console.log("Checking option flag:",o),console.log("Full Variant Object:",e),console.log("Variant Options:",e.options);const a=e[["option1","option2","option3"][n]];a&&(t.textContent=a,t.classList.add("selected"))})}if(!l){const e=`layer-${this.selectedComponent.handle}`,t=document.getElementById(e);t&&(t.src=a,t.classList.add("visible"))}l||this.initialImages.set(i,{mobile:a,desktop:a})}applySelection(e,t){if(!this.selectedComponent||!this.selectedVariant)return;const n=this.selectedComponent.isOptionalSelection?`${this.selectedComponent.handle}-optional`:this.selectedComponent.handle,o=document.getElementById("option-quantity"),a=this.selectedComponent.isOptionalSelection&&o?parseInt(o.value)||1:1,i={...this.selectedVariant,quantity:a};if(this.selectedComponent.isOptionalSelection){let e=this.selectedVariants.get(n)||[];e=Array.isArray(e)?e:[e];const t=e.findIndex(e=>e.id===this.selectedVariant.id);-1===t?e.push(i):e[t].quantity+=a,this.selectedVariants.set(n,e)}else this.selectedVariants.set(n,i);this.updateAllComponentStatuses(),this.updateConfiguratorSummary(),this.updateTotalPrice(),this.evaluateConflicts(),e&&t&&this.selectedComponent&&this.selectedComponent.isOptionalSelection&&setTimeout(()=>{if(this.checkIsMobile()){const e=t.querySelector(".component-card__image");e&&(e.src=this.selectedComponent.blueprint);const n=t.querySelector(".mobile-card-options");n&&this.resetOptionsContent(n)}else{const e=t.parentElement.querySelector(".component-navigation__image");e&&(console.log("Resetting navigation image fo real"),e.src=this.selectedComponent.blueprint);const n=t.parentElement;n&&this.resetOptionsContent(n)}e&&(e.textContent="Add to Configuration",e.disabled=!0)},1e3),this.showToast(`${this.selectedComponent.title} added successfully`,"success")}updateComponentStatus(e,t){const n=document.querySelector(`.component-card[data-component-id="${e}"]`);if(!n)return;const o=this.components.find(t=>t.handle===e.replace(/-optional$/,""));if(!o)return;const a=n.querySelector(".status-badge");if(a)if(t||this.selectedVariants.has(e)){a.classList.remove("hidden"),n.classList.add("configured");const o=t||this.selectedVariants.get(e),i=o&&!o.available,l=document.querySelector(".add-to-cart-button");if(l){const e=Array.from(this.selectedVariants.entries()).some(([e,t])=>{const n=Array.isArray(t)?t:[t],o=n.some(e=>!e?.available);return o});this.completedRequiredComponents>=this.totalRequiredComponents&&!e?(l.classList.remove("disabled"),l.disabled=!1,l.textContent="Add to Cart"):(l.classList.add("disabled"),l.disabled=!0,l.textContent=e?"Contains Sold Out Items":`${this.getCompletedRequiredCount()} / ${this.totalRequiredComponents} Components Selected`)}}else if(a.classList.add("hidden"),n.classList.remove("configured"),o.required&&!e.endsWith("-optional")){const e=document.querySelector(".add-to-cart-button");e&&(e.classList.add("disabled"),e.disabled=!0,e.textContent=`${this.getCompletedRequiredCount()} / ${this.totalRequiredComponents} Components Selected`)}const i=`layer-${o.handle}`,l=document.getElementById(i);l&&(t||this.selectedVariants.has(e)?(l.classList.add("visible"),t&&(l.src=t.featured_image||o.featured_image)):l.classList.remove("visible")),e.endsWith("-optional")||this.updateExtraComponents()}getCompletedRequiredCount(){return this.components.reduce((e,t)=>t.required&&this.selectedVariants.has(t.handle)?e+1:e,0)}updateAllComponentStatuses(){this.components.forEach(e=>{const t=e.handle,n=`${t}-optional`;this.selectedVariants.has(t)?this.updateComponentStatus(t):this.selectedVariants.has(n)?this.updateComponentStatus(n):this.updateComponentStatus(t)});const e=this.getCompletedRequiredCount();this.counterCurrent&&(this.counterCurrent.textContent=e),this.evaluateConflicts()}updateSelectedVariant(e="desktop"){if(!this.selectedComponent)return null;const t="desktop"===e?document.querySelectorAll(".options-grid .option-select"):document.querySelectorAll(".mobile-component-card.active .mobile-option-select"),n=Array.from(t).map(e=>e.value).filter(e=>""!==e);let o;if(o="desktop"===e?document.querySelector(".options-grid"):document.querySelector(".mobile-component-card.active .mobile-card-options"),n.length!==this.selectedComponent.options.length){if(o){const e=o.querySelector(".apply-selection-button");e&&(e.disabled=!0)}return null}const a=this.getMatchingVariantFromSelections(n);if(o){const e=o.querySelector(".apply-selection-button");e&&(e.disabled=!a)}return a&&(this.selectedVariant=a,this.updateUI(a)),a}handleVariantChange(e,t="desktop"){const n=e.target,o=parseInt(n.dataset.position,10),a=n.value,i=new Map;console.log("handleVariantChange received",i);const l="desktop"===t?document.querySelectorAll(".options-grid .option-select"):document.querySelectorAll(".mobile-component-card.active .mobile-option-select");l.forEach((e,t)=>{e.value&&i.set(t+1,e.value)}),l.forEach(e=>{const t=parseInt(e.dataset.position,10);if(t>o){e.innerHTML="";const t=document.createElement("option");t.value="",t.textContent=`Select ${e.dataset.optionName}`,t.disabled=!0,t.selected=!0,e.appendChild(t)}});const r=o+1,d=this.getAvailableOptionsForPosition(r,i,t),s=[...l].find(e=>parseInt(e.dataset.position)===r);s&&d.forEach(e=>{const t=document.createElement("option");t.value=e.split(" - ")[0],t.textContent=e,s.appendChild(t)});const c=this.updateSelectedVariant(t);if(c){if(this.selectedVariant=c,!this.selectedComponent.isOptionalSelection)this.applySelection();else if("carousel"===t){const t=e.target.closest(".mobile-component-card");if(t){const e=t.querySelector(".apply-selection-button");e&&(e.disabled=!1)}}}else if(!this.selectedComponent.required&&"carousel"===t){const t=e.target.closest(".mobile-component-card");if(t){const e=t.querySelector(".apply-selection-button");e&&(e.disabled=!0)}}}removeComponentFromConfiguration(e){const t=e.isOptionalSelection?`${e.handle}-optional`:e.handle;this.selectedVariants.delete(t),this.updateAllComponentStatuses(),this.updateConfiguratorSummary(),this.evaluateConflicts(),this.showToast(`${e.title} removed`,"info")}updateExtraComponents(){const e=document.querySelectorAll(".component-card[data-component-id$=\"-optional\"]"),t=document.getElementById("optional-components"),n=[],o=[];e.forEach(e=>{const t=e.dataset.componentId.replace(/-optional$/,""),a=document.querySelector(`.component-card[data-component-id="${t}"]`);if(a){o.push(e);const n=this.selectedVariants.has(t);if(!n){if(e.classList.add("locked"),!e.querySelector(".lock-icon")){const n=document.createElement("div");n.className="lock-icon",n.innerHTML=`
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/>
              </svg>
            `;const o=document.createElement("div");o.className="tooltip";const a=this.components.find(e=>e.handle===t);o.textContent=`Please add a ${a?this.formatComponentTitle(a.title):""} to your configuration first`,e.appendChild(n),e.appendChild(o)}e.querySelectorAll("select, button, input").forEach(e=>{e.disabled=!0})}else{e.classList.remove("locked");const t=e.querySelector(".lock-icon"),n=e.querySelector(".tooltip");t&&t.remove(),n&&n.remove(),e.querySelectorAll("select, button, input").forEach(e=>{e.disabled=!1})}}else n.push(e)}),this.checkIsMobile()||(n.forEach(e=>{t.appendChild(e)}),o.forEach(e=>{t.appendChild(e)}));const a=document.querySelector(".extra-components");if(!a)return;let i="";this.selectedVariants.forEach((e,t)=>{if(!t.endsWith("-optional"))return;const n=t.replace("-optional",""),o=this.components.find(e=>e.handle===n);if(o){i+=`
        <div class="extra-component">
          <h3 class="extra-component-title">${o.title}</h3>
          <div class="optional-variants-list">
      `;const t=Array.isArray(e)?e:[e];t.forEach(e=>{const t=e.quantity||1,o=e.price*t;i+=`
          <div class="optional-variant-row">
            <div class="optional-variant-info">
              ${e.title}
              <button class="remove-optional" data-handle="${n}" data-variant-id="${e.id}">
                <svg viewBox="0 0 24 24" width="16" height="16">
                  <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
              </button>
            </div>
            <div class="optional-variant-price-group">
              <div class="quantity-input">
                <span class="quantity-prefix">x</span><input 
                  type="number" 
                  class="variant-quantity" 
                  value="${t}"
                  min="1"
                  data-handle="${n}"
                  data-variant-id="${e.id}"
                >
              </div>
              <div class="optional-variant-price">$${(o/100).toFixed(2)}</div>
            </div>
          </div>
        `}),i+=`
          </div>
        </div>
      `}}),a.innerHTML=i}handleQuantityChange(t){const e=t.target,n=e.dataset.handle,o=parseInt(e.dataset.variantId,10),a=parseInt(e.value)||1;if(1>a)return void(e.value=1);const i=`${n}-optional`,l=this.selectedVariants.get(i);if(!l)return;const r=Array.isArray(l)?l:[l],d=r.find(e=>e.id===o);if(d){d.quantity=a,this.selectedVariants.set(i,r);const t=e.closest(".summary-item");if(t){const e=t.querySelector(".summary-item__price");if(e){const t=d.price*a;e.textContent=`$${(t/100).toFixed(2)}`}}this.updateTotalPrice(),this.evaluateConflicts()}}updateOptionFlags(e,t,n=!1){if(e){const o=e.querySelectorAll(".option-flag");o.forEach(e=>{const o=e.dataset.option;if(o)if(n){const t=this.selectedComponent?.options?.find(e=>e&&e.name&&o&&e.name.toLowerCase()===o.toLowerCase());t&&(e.textContent=t.name)}else{const n=Array.from(t).find(e=>e&&e.dataset.optionName&&e.dataset.optionName===o);n&&n.value&&(e.textContent=n.value)}})}}setupResponsiveListener(){let e;window.addEventListener("resize",()=>{isScrolling||(clearTimeout(e),e=setTimeout(()=>{this.checkIsMobile()?this.restoreMobileLayout():this.restoreDesktopLayout();const e=document.querySelector(".configuration-summary");e&&this.insertConfiguratorSummary(e)},150))}),this.checkIsMobile()?this.restoreMobileLayout():this.restoreDesktopLayout();const t=document.querySelector(".configuration-summary");t&&this.insertConfiguratorSummary(t)}restoreDesktopLayout(){const e=document.querySelector(".configurator__options"),t=document.querySelector(".configuration-summary");t&&e&&!e.contains(t)&&e.appendChild(t);const n=document.querySelectorAll(".mobile-component-card");n.forEach(e=>{const t=e.querySelector(".component-card");if(!t)return;const n=t.dataset.componentId,o=this.components.find(e=>e.handle===n);if(o){const e=o.required?document.querySelector("#required-components"):document.querySelector("#optional-components");e&&e.appendChild(t)}})}restoreMobileLayout(){if(isScrolling)return;const e=document.querySelector(".mobile-bottom-bar"),t=document.querySelector(".mobile-carousel-container"),n=document.querySelector(".configuration-summary"),o=document.querySelector(".configurator__preview");if(!e||!t||!n)return;e.contains(n)||e.appendChild(n),o&&!o.nextSibling?.classList.contains("mobile-carousel-container")&&o.parentNode.insertBefore(t,o.nextSibling);const a=n.querySelector(".summary-header"),i=n.querySelector(".summary-content");if(a&&i){const e="true"===a.getAttribute("aria-expanded");e&&a.click()}}checkIsMobile(){return 768>=window.innerWidth}setUpMobileLayout(){let e=document.querySelector(".mobile-carousel-container");if(!e){e=document.createElement("div"),e.classList.add("mobile-carousel-container");const t=document.querySelector(".configurator__preview");t&&t.parentNode&&t.parentNode.insertBefore(e,t.nextSibling)}this.setupMobileCarousel(e),this.createMobileBottomBar(),this.evaluateConflicts(),this.updateConfiguratorSummary(),this.updateTotalPrice()}setupMobileCarousel(e){const t=document.createElement("div");t.classList.add("mobile-carousel-track"),e.style.perspective="1000px",e.appendChild(t);const n=document.querySelectorAll(".component-card");n.forEach(e=>{const n=e.getAttribute("data-component-handle");if(n){const o=this.components.find(e=>e.handle===n);if(o){const n=this.buildMobileCarouselCard(o,e.dataset.componentId);this.carouselCards.push(n),t.appendChild(n)}}}),this.updateOptionsGrid("carousel"),this.attachGestureHandlers(e),this.carouselIndex=0,this.renderMobileCarousel()}buildMobileCarouselCard(e,t){const n=document.createElement("div");n.classList.add("mobile-component-card"),n.setAttribute("data-handle",t);const o=document.querySelector(`.component-card[data-component-id="${t}"]`);o&&(o.style.display="block",n.append(o));const a=document.createElement("div");return a.classList.add("mobile-card-options"),n.appendChild(a),e.options.forEach((t,n)=>{const o=document.createElement("div");o.classList.add("mobile-option-container");const i=document.createElement("label");i.textContent=t.name,o.appendChild(i);const l=document.createElement("select");l.classList.add("mobile-option-select"),l.dataset.componentHandle=e.handle,l.dataset.position=n+1;const r=document.createElement("option");r.value="",r.textContent=`Select ${t.name}`,r.disabled=!0,r.selected=!0,l.appendChild(r),l.addEventListener("change",t=>{this.handleVariantChange(t,"carousel")}),o.appendChild(l),a.appendChild(o)}),this.handleDropDownAvailability(a),n}renderMobileCarousel(){this.carouselCards.forEach((e,t)=>{const n=t-this.carouselIndex;0==n?e.classList.add("active"):e.classList.remove("active");let o=1-Math.abs(n)*(1-.8),a=0==n?100:0;e.style.transition="transform 0.4s ease",e.style.transformStyle="preserve-3d",e.style.transform=`
        translateX(${n*70}px)
        translateZ(${a}px)
        rotateY(${n*-30}deg)
        scale(${o})
      `;let i=1-.15*Math.abs(n);.3>i&&(i=.3),e.style.opacity=i.toString(),e.style.zIndex=100-Math.abs(n)});const e=document.querySelector(".mobile-carousel-track");if(e){e.getBoundingClientRect()}const t=document.querySelector(".configurator__grid");if(t){t.getBoundingClientRect()}}attachGestureHandlers(e){let t=!1,n=!1,o=!1;e.addEventListener("touchstart",a=>{this.carouselIsDragging=!0,this.carouselStartX=a.touches[0].clientX,this.carouselStartY=a.touches[0].clientY,o=!1,t=!1,n=!1}),e.addEventListener("touchmove",a=>{if(!this.carouselIsDragging||o)return;const e=a.touches[0].clientX-this.carouselStartX,i=a.touches[0].clientY-this.carouselStartY;n||t||(Math.abs(e)>Math.abs(i)&&10<Math.abs(e)?n=!0:Math.abs(i)>Math.abs(e)&&10<Math.abs(i)&&(t=!0)),n&&(a.preventDefault(),20<Math.abs(e)&&(o=!0,0<e?this.goToCard(this.carouselIndex-1):this.goToCard(this.carouselIndex+1),this.carouselStartX=a.touches[0].clientX,this.carouselStartY=a.touches[0].clientY))}),e.addEventListener("touchend",()=>{this.carouselIsDragging=!1})}goToCard(e){0>e&&(e=0),e>=this.carouselCards.length&&(e=this.carouselCards.length-1);const t=document.querySelector(".component-card.selected");t&&t.classList.remove("selected"),this.carouselIndex=e,this.renderMobileCarousel();const n=this.carouselCards[this.carouselIndex],o=n?.dataset.handle,a=o.replace(/-optional$/,""),i=this.components.find(e=>e.handle===a);if(i){this.selectedComponent=i,this.selectedComponent.isOptionalSelection=!!o.endsWith("-optional");const e=n.querySelector(".component-card");e&&e.classList.add("selected"),this.updateOptionsGrid("carousel"),this.updateSelectedVariant("carousel")}}createMobileBottomBar(){let e=document.querySelector(".mobile-bottom-bar");e||(e=document.createElement("div"),e.classList.add("mobile-bottom-bar"),document.body.appendChild(e))}getSelectedVariants(e){const t=this.selectedVariants.get(e)||[],n=this.selectedVariants.get(`${e}-optional`)||[],o=Array.isArray(t)?t:[t],a=Array.isArray(n)?n:[n];return[...o,...a]}getVariantTitle(e,t){const n=e.replace(/-optional$/,""),o=this.components.find(e=>e.handle===n);if(!o)return"Unknown Variant";const a=o.variants.find(e=>e.id===t);return a?a.title:"Unknown Variant"}evaluateConflicts(){this.clearAllConflictBadges();let e=!1,t=!1;this.components.forEach(e=>{e.required&&!this.selectedVariants.has(e.handle)&&(t=!0)}),this.conflicts.forEach(t=>{const{component1:n,component1_variants:o,component2:a,component2_variants:i}=t,l=this.getSelectedVariants(n),r=this.getSelectedVariants(a),d=new Set(o.map(Number)),s=new Set(i.map(Number));let c=!1;l.forEach(e=>{if(d.has(e.id)){const o=r.some(e=>!s.has(e.id));o||(c=!0,this.displayConflictBadge(n,this.buildConflictMessage({conflictVariantName:this.getVariantTitle(n,e.id),conflictSide:n,otherSide:a,fallbackDisclaimer:t.disclaimer}),e.id))}}),r.forEach(e=>{if(s.has(e.id)){const o=l.some(e=>!d.has(e.id));o||(c=!0,this.displayConflictBadge(a,this.buildConflictMessage({conflictVariantName:this.getVariantTitle(a,e.id),conflictSide:a,otherSide:n,fallbackDisclaimer:t.disclaimer}),e.id))}}),c&&(e=!0)}),this.updateAddToCartButton(e,t)}buildConflictMessage({conflictVariantName:e,conflictSide:t,otherSide:n,fallbackDisclaimer:o=""}){const a=n,i=this.components.find(e=>e.handle===a.replace(/-optional$/,"")),l=i.variants.filter(e=>!this.getConflictVariantIdsForComponent(i.handle).includes(e.id)),r=l.map(e=>`
          <button 
            class="conflict-suggestion-button" 
            data-component="${a}" 
            data-variant-id="${e.id}"
          >
            ${e.title}
          </button>`).join(" ");return`
      <div class="conflict-message">
        <div class="tooltip-content">
          <p>
            The <span class="tooltip-badge">${e} ${this.formatComponentTitle(t)}</span> 
            is incompatible with the <span class="tooltip-badge">${this.getVariantTitle(n,this.getConflictVariantIdsForComponent(n)[0])} ${this.formatComponentTitle(n)}</span>.
          </p>
          <p>Compatible variants:</p>
          <div class="conflict-suggestion-buttons">
            ${r}
          </div>
        </div>
      </div>`}getConflictVariantIdsForComponent(e){const t=new Set;return this.conflicts.forEach(n=>{n.component1===e&&n.component1_variants.map(e=>parseInt(e,10)).forEach(e=>t.add(e)),n.component2===e&&n.component2_variants.map(e=>parseInt(e,10)).forEach(e=>t.add(e))}),Array.from(t)}displayConflictBadge(e,t,n){const o=`${e}-optional`,a=this.selectedVariants.has(o)&&this.selectedVariants.get(o).some(e=>e.id===n),i=a?o:e,l=document.querySelector(`[data-component="${i}"]`);if(l){const e=l.querySelector(`.summary-item__variant[data-variant-id="${n}"]`);if(e&&!e.querySelector(".conflict-icon")){const n=document.createElement("span");n.classList.add("conflict-icon","material-symbols-outlined"),n.textContent="warning",n.style.color="#FFC107";const o=document.createElement("div");o.classList.add("variant-tooltip"),o.innerHTML=t,n.appendChild(o),e.appendChild(n)}}}clearAllConflictBadges(){const e=document.querySelectorAll(".summary-item__variant");e.forEach(e=>{e.classList.remove("conflict"),e.removeAttribute("data-tooltip");const t=e.querySelector(".variant-tooltip");t&&t.remove();const n=e.querySelector(".conflict-icon");n&&n.remove()})}updateAddToCartButton(e,t){const n=document.querySelector(".add-to-cart-button");n&&(e?(n.disabled=!0,n.classList.add("disabled"),n.textContent="Resolve Conflicts"):t?(n.disabled=!0,n.classList.add("disabled"),n.textContent=`${this.getCompletedRequiredCount()} / ${this.totalRequiredComponents} Components Selected`):(n.disabled=!1,n.classList.remove("disabled"),n.textContent="Add to Cart"))}formatComponentTitle(e,t=!1,n=!1){const o=this.parentProductTitle.toLowerCase(),a=e.toLowerCase(),i=e.replace(new RegExp(o,"i"),"").replace(/[-_]/g," ").trim();return t&&n?`Extra ${i}`:i}handleize(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-$/,"").replace(/^-/,"")}parseVariantTitle(e){return e?e.split(" / ").map(e=>e.trim()):[]}areAllDropdownsFilled(){const e=document.querySelectorAll(".option-select");return Array.from(e).every(e=>""!==e.value)}showToast(e,t="success"){const n=document.createElement("div");n.className=`toast ${t}`;const o=Date.now().toString();n.dataset.toastId=o;const a=document.createElement("div");a.className="toast-title",a.textContent=this.formatComponentTitle(e),n.appendChild(a);let i;if(this.selectedComponent){const e=this.selectedComponent.isOptionalSelection?`${this.selectedComponent.handle}-optional`:this.selectedComponent.handle;i=this.selectedVariants.get(e),this.selectedComponent.isOptionalSelection&&Array.isArray(i)&&(i=i[i.length-1])}if(i){const e=document.createElement("div");e.className="toast-variant",e.textContent=i.title,n.appendChild(e)}const l=document.querySelector(".toast-container");if(l){l.insertBefore(n,l.firstChild),this.toastTimeouts.has(o)&&clearTimeout(this.toastTimeouts.get(o));const e=setTimeout(()=>{n.style.animation="fadeOut 0.3s ease-out forwards";const e=setTimeout(()=>{l.contains(n)&&(l.removeChild(n),this.toastTimeouts.delete(o))},300);this.toastTimeouts.set(o+"_remove",e)},3e3);this.toastTimeouts.set(o,e)}else console.error("[Toast Debug] Toast container not found!")}navigateComponents(e){const t=Array.from(document.querySelectorAll(".component-card:not(.locked)")),n=t.findIndex(e=>e.classList.contains("selected"));let o="next"===e?n+1>=t.length?0:n+1:0>n-1?t.length-1:n-1;const a=t[o];if(a){const e=null!==a.querySelector(".required-badge"),t=document.querySelector(".tab-button.active"),n=document.querySelector(".tab-button[data-tab=\"required\"]"),o=document.querySelector(".tab-button[data-tab=\"optional\"]");e&&"required"!==t.dataset.tab?n.click():!e&&"optional"!==t.dataset.tab&&o.click(),this.selectComponent(a.dataset.componentId,!0);const i=document.querySelector(".components-grid"),l=a.getBoundingClientRect(),r=i.getBoundingClientRect();l.right>r.right?i.scrollBy({left:l.width,behavior:"smooth"}):l.left<r.left&&i.scrollBy({left:-l.width,behavior:"smooth"})}}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{const t=document.querySelector(".image-modal");if(!(t&&t.classList.contains("active"))){if("SELECT"===e.target.tagName&&"Tab"===e.key&&!e.shiftKey){const t=e.target,n=Array.from(document.querySelectorAll(".option-select")),o=n.indexOf(t);if(o===n.length-1&&this.areAllDropdownsFilled()){e.preventDefault();const t=document.querySelector(".apply-selection-button:not(.hidden)");t?t.focus():this.navigateComponents("next")}return}("ArrowLeft"===e.key||"ArrowRight"===e.key)&&(e.preventDefault(),this.navigateComponents("ArrowLeft"===e.key?"prev":"next"))}})}updateNavigationButtons(){const e=document.querySelector(".prev-component"),t=document.querySelector(".next-component"),n=document.querySelector(".forward-component");e&&(e.disabled=!1),t&&(t.disabled=!1),n&&(n.disabled=!1)}}function setLoading(e){loadingOverlay.classList.toggle("loading",e),modalImage.classList.toggle("loading",e)}function openModal(e){currentImageIndex=e,updateModalImage(),modal.classList.add("active")}function closeModal(){modal.classList.remove("active"),setTimeout(()=>{modalImage.src=images[currentImageIndex].thumbnail,setLoading(!1)},300)}function updateModalImage(){setLoading(!0),modalImage.src=images[currentImageIndex].thumbnail;const e=modal.querySelector(".image-type-indicator"),t=images[currentImageIndex].alt.toLowerCase();e.textContent=t.includes("none")?"":t.includes("render")?"RENDER":"ACTUAL IMAGE";const n=new Image;n.onload=function(){const e=modal.querySelector(".modal-image-container"),t=modal.querySelector(".modal-content"),o=.85*window.innerHeight,a=.75*window.innerWidth,i=n.naturalHeight/n.naturalWidth;let l,r;i*a<=o?(l=a,r=a*i):(r=o,l=o/i),e.style.width=`${l}px`,e.style.height=`${r}px`,modalImage.src=images[currentImageIndex].fullRes,setTimeout(()=>{setLoading(!1)},100)},n.src=images[currentImageIndex].fullRes,modalImage.alt=images[currentImageIndex].alt}function nextImage(){currentImageIndex=(currentImageIndex+1)%images.length,updateModalImage()}function prevImage(){currentImageIndex=(currentImageIndex-1+images.length)%images.length,updateModalImage()}document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".image-modal"),n=t.querySelector(".modal-image"),o=t.querySelector(".modal-loading-overlay"),a=t.querySelector(".modal-close"),i=t.querySelector(".modal-prev"),l=t.querySelector(".modal-next"),r=document.querySelectorAll(".product-thumbnail");Array.from(r).map(e=>({fullRes:e.dataset.fullRes,thumbnail:e.dataset.thumbnail,alt:e.querySelector("img").alt}));if(r.forEach((e,t)=>{e.addEventListener("click",n=>{n.preventDefault(),openModal(t)})}),a.addEventListener("click",closeModal),l.addEventListener("click",nextImage),i.addEventListener("click",prevImage),t.addEventListener("click",n=>{n.target===t&&closeModal()}),document.addEventListener("keydown",n=>{if(t.classList.contains("active"))switch(n.preventDefault(),n.key){case"Escape":closeModal();break;case"ArrowLeft":prevImage();break;case"ArrowRight":nextImage();}}),1024>=window.innerWidth){const e=document.querySelector(".configurator__preview"),t=document.querySelector(".mobile-bottom-bar"),n=document.querySelector(".render-disclaimer"),o=document.querySelector(".preview-product-logo"),a=e.parentNode,i=e.nextSibling,l=document.createElement("div");l.style.width="100%",l.style.display="none",requestAnimationFrame(()=>{l.style.height=`${e.offsetHeight}px`}),a.insertBefore(l,e);let r=window.scrollY,d=null,s=!1,c=!1;window.addEventListener("scroll",e=>{if(c)return void e.preventDefault();const t=window.scrollY,n=t>r,o=t<r,a=document.querySelector(".configurator__preview");if(!s&&10<t&&a){s=!0,c=!0;const e=a.getBoundingClientRect().top+window.scrollY-20;window.scrollTo(0,t),setTimeout(()=>{window.scrollTo(0,t)},10);let n=0;const o=setInterval(()=>{const t=e-window.scrollY;return 2>Math.abs(t)?(clearInterval(o),void(c=!1)):void(window.scrollBy(0,.2*t),n++,15<n&&(clearInterval(o),c=!1))},16);return}n&&"down"!==d&&(d="down"),o&&"up"!==d&&(d="up"),r=t})}});